<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Controle de Mira</title>
</head>
<body>
  <h1>Mira do Celular</h1>
  <button onclick="ativarSensores()">ğŸ“± Ativar Sensores</button>
  <button onclick="shoot()">ğŸ”« Atirar</button>

  <script>
    const socket = new WebSocket("ws://192.168.147.188:3000"); // <-- use o IP do seu PC aqui

    socket.onopen = () => alert("âœ… Conectado ao WebSocket");
    socket.onerror = err => alert("âŒ Erro:", err);
    socket.onclose = () => alert("ğŸ”Œ ConexÃ£o encerrada");

    function shoot() {
      if (socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({ type: "shoot" }));
        console.log("ğŸ”« Enviado: { type: 'shoot' }");
      }
    }

    function ativarSensores() {
      console.log("ğŸŸ¡ Android/Chrome: ativando sensores");

      if (typeof DeviceOrientationEvent !== "undefined") {
        window.addEventListener("deviceorientation", handleOrientation);
        console.log("âœ… Sensor de orientaÃ§Ã£o ativado.");
      } else {
        alert("âš ï¸ Seu navegador nÃ£o suporta DeviceOrientationEvent.");
      }
    }

    function handleOrientation(event) {
      if (socket.readyState === WebSocket.OPEN) {
        const payload = {
          type: "aim",
          alpha: event.alpha,
          beta: event.beta,
          gamma: event.gamma,
        };
        socket.send(JSON.stringify(payload));
        console.log("ğŸ¯ Enviado:", payload);
      }
    }
  </script>
</body>
</html>
